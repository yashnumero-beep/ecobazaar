<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoBazaar - Sustainable Shopping</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2ecc71;
            --primary-dark: #27ae60;
            --secondary-color: #3498db;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header & Navigation */
        .header {
            background-color: white;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-decoration: none;
        }

        .logo i {
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-link:hover {
            background-color: var(--light-color);
            color: var(--primary-dark);
        }

        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 8px 16px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
        }

        .user-role {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-seller {
            background-color: var(--warning-color);
            color: white;
        }

        .role-admin {
            background-color: var(--danger-color);
            color: white;
        }

        .role-user {
            background-color: var(--secondary-color);
            color: white;
        }

        /* Landing Page */
        .landing-hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .landing-hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .landing-hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: white;
            color: var(--primary-dark);
        }

        .btn-primary:hover {
            background-color: var(--light-color);
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background-color: white;
            color: var(--primary-dark);
        }

        .features-section {
            padding: 80px 0;
            background-color: white;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            color: var(--dark-color);
            margin-bottom: 50px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background-color: #f8f9fa;
            padding: 40px 30px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .mission-section {
            padding: 80px 0;
            background: linear-gradient(135deg, #f8f9fa, #e8f5e9);
        }

        .mission-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .mission-content h2 {
            font-size: 2.5rem;
            color: var(--dark-color);
            margin-bottom: 30px;
        }

        .mission-content p {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 20px;
        }

        /* Login/Register Forms */
        .auth-section {
            max-width: 500px;
            margin: 60px auto;
            padding: 40px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .auth-section h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #2980b9;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-block {
            width: 100%;
        }

        /* Dashboard */
        .dashboard {
            padding: 30px 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 2rem;
            color: var(--dark-color);
        }

        .dashboard-subtitle {
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .card-value.secondary {
            color: var(--secondary-color);
        }

        .card-value.warning {
            color: var(--warning-color);
        }

        .card-value.danger {
            color: var(--danger-color);
        }

        /* Product Tables */
        .products-section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--dark-color);
        }

        .table-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--light-color);
        }

        th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 2px solid #ddd;
        }

        td {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background-color: #d5f4e6;
            color: var(--primary-dark);
        }

        .badge-warning {
            background-color: #fef5e7;
            color: var(--warning-color);
        }

        .badge-danger {
            background-color: #fdedec;
            color: var(--danger-color);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .btn-icon {
            padding: 8px;
            width: 36px;
            height: 36px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--dark-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        .modal-body {
            padding: 30px;
        }

        /* Image Preview */
        .image-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Carbon Inputs */
        .carbon-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .carbon-input {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .carbon-input label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--gray-color);
        }

        .carbon-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        /* Shopper Page */
        .shopper-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 60px 0;
            text-align: center;
            margin-bottom: 40px;
        }

        .shopper-header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .shopper-header p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Search and Filter Section */
        .search-filter-section {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .product-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-body {
            padding: 20px;
        }

        .product-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .product-footer {
            padding: 15px 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .carbon-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .eco-rating {
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .rating-a {
            background-color: #d5f4e6;
            color: var(--primary-dark);
        }

        .rating-b {
            background-color: #e8f6f3;
            color: #1abc9c;
        }

        .rating-c {
            background-color: #fef9e7;
            color: var(--warning-color);
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mb-30 {
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: #d5f4e6;
            color: var(--primary-dark);
            border-left: 4px solid var(--primary-color);
        }

        .alert-error {
            background-color: #fdedec;
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        .alert-warning {
            background-color: #fef9e7;
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-color);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 992px) {
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                position: absolute;
                top: 70px;
                left: 0;
                width: 100%;
                background-color: white;
                box-shadow: var(--box-shadow);
                padding: 20px;
                display: none;
            }

            .nav-links.active {
                display: flex;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 800px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .landing-hero h1 {
                font-size: 2.5rem;
            }

            .landing-hero p {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
<!-- Header with Navigation -->
<header class="header hidden" id="appHeader">
    <div class="container nav-container">
        <a href="#" class="logo" onclick="showLandingPage()">
            <i class="fas fa-leaf"></i>
            <span>EcoBazaar</span>
        </a>

        <div class="nav-links" id="navLinks">
            <a href="#" class="nav-link" id="homeLink" onclick="showLandingPage()">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="#" class="nav-link hidden" id="sellerLink" onclick="showSellerDashboard()">
                <i class="fas fa-store"></i> Seller Dashboard
            </a>
            <a href="#" class="nav-link hidden" id="adminLink" onclick="showAdminDashboard()">
                <i class="fas fa-user-shield"></i> Admin Dashboard
            </a>
            <a href="#" class="nav-link hidden" id="shopperLink" onclick="showShopperPage()">
                <i class="fas fa-shopping-bag"></i> Shop
            </a>

            <div class="user-info hidden" id="userInfo">
                <span id="userName">Guest</span>
                <span class="user-role" id="userRole">Not Logged In</span>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
            </div>
        </div>

        <button class="btn btn-icon" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

<!-- Landing Page -->
<section id="landingPage">
    <div class="landing-hero">
        <div class="container">
            <h1>Shop Sustainably, Live Consciously</h1>
            <p>EcoBazaar connects eco-conscious consumers with verified sustainable products. Every purchase makes a difference for our planet.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="showLoginPage()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="btn btn-outline" onclick="showRegisterPage()">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
            </div>
        </div>
    </div>

    <div class="features-section">
        <div class="container">
            <h2 class="section-title">Why Choose EcoBazaar?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h3 class="feature-title">Carbon Footprint Transparency</h3>
                    <p>Every product shows its carbon impact, so you can make informed decisions about your purchases.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="feature-title">Verified Eco-Friendly</h3>
                    <p>All products undergo strict verification to ensure they meet our sustainability standards.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3 class="feature-title">Support Ethical Sellers</h3>
                    <p>Connect directly with sellers who prioritize environmental responsibility and fair practices.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="mission-section">
        <div class="container">
            <div class="mission-content">
                <h2>Our Mission</h2>
                <p>At EcoBazaar, we believe that every purchase has an impact. Our mission is to make sustainable shopping accessible, transparent, and rewarding for everyone.</p>
                <p>We provide a platform where environmentally conscious consumers can find products that align with their values, and where responsible sellers can reach an audience that cares about more than just the price tag.</p>
                <p>Join us in building a greener future, one purchase at a time.</p>
                <button class="btn btn-primary mt-30" onclick="showRegisterPage()">
                    <i class="fas fa-seedling"></i> Join the Movement
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Login Page -->
<section id="loginPage" class="hidden">
    <div class="auth-section">
        <h2>Welcome Back</h2>
        <div class="form-group">
            <label for="loginEmail">Email</label>
            <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email">
        </div>

        <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password">
        </div>

        <div class="form-group">
            <button class="btn btn-primary btn-block" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </div>

        <div class="text-center">
            <p>Don't have an account? <a href="#" onclick="showRegisterPage()">Sign up here</a></p>
            <p><a href="#" onclick="showLandingPage()">← Back to Home</a></p>
        </div>

        <div id="loginAlert" class="alert hidden"></div>
    </div>
</section>

<!-- Register Page -->
<section id="registerPage" class="hidden">
    <div class="auth-section">
        <h2>Create Your Account</h2>

        <div class="form-group">
            <label for="regEmail">Email</label>
            <input type="email" id="regEmail" class="form-control" placeholder="Enter your email">
        </div>

        <div class="form-group">
            <label for="regPassword">Password</label>
            <input type="password" id="regPassword" class="form-control" placeholder="At least 6 characters">
        </div>

        <div class="form-group">
            <label for="regFullName">Full Name</label>
            <input type="text" id="regFullName" class="form-control" placeholder="Enter your full name">
        </div>

        <div class="form-group">
            <label for="regRole">Account Type</label>
            <select id="regRole" class="form-control">
                <option value="USER">Shopper - I want to buy eco-friendly products</option>
                <option value="SELLER">Seller - I want to sell sustainable products</option>
                <option value="ADMIN">Admin - I need administrative access</option>
            </select>
            <small class="dashboard-subtitle">Choose carefully as role changes require admin approval</small>
        </div>

        <div class="form-group">
            <button class="btn btn-primary btn-block" onclick="register()">
                <i class="fas fa-user-plus"></i> Create Account
            </button>
        </div>

        <div class="text-center">
            <p>Already have an account? <a href="#" onclick="showLoginPage()">Login here</a></p>
            <p><a href="#" onclick="showLandingPage()">← Back to Home</a></p>
        </div>

        <div id="registerAlert" class="alert hidden"></div>
    </div>
</section>

<!-- Seller Dashboard -->
<section id="sellerDashboard" class="dashboard hidden">
    <div class="container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Seller Dashboard</h1>
            <button class="btn btn-primary" onclick="showAddProductModal()">
                <i class="fas fa-plus"></i> Add Product
            </button>
        </div>

        <p class="dashboard-subtitle">Manage your products and track performance</p>

        <div id="sellerStats" class="dashboard-cards">
            <!-- Stats will be loaded dynamically -->
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading dashboard...</p>
            </div>
        </div>

        <div class="products-section">
            <div class="section-header">
                <h2 class="section-title">Your Products</h2>
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="loadSellerProducts()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="sellerProductsTable">
                    <thead>
                    <tr>
                        <th>Image</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Carbon Footprint</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="sellerProductsBody">
                    <tr>
                        <td colspan="7" class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading products...</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<!-- Admin Dashboard -->
<section id="adminDashboard" class="dashboard hidden">
    <div class="container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="loadPendingProducts()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>

        <p class="dashboard-subtitle">Manage product verification and platform analytics</p>

        <div id="adminStats" class="dashboard-cards">
            <!-- Stats will be loaded dynamically -->
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading dashboard...</p>
            </div>
        </div>

        <div class="products-section">
            <div class="section-header">
                <h2 class="section-title">Products Pending Verification</h2>
                <div class="action-buttons">
                    <button class="btn btn-warning btn-sm" onclick="showVerifiedProducts()">
                        Show Verified Products
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="pendingProductsTable">
                    <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Seller</th>
                        <th>Price</th>
                        <th>Carbon Footprint</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="pendingProductsBody">
                    <tr>
                        <td colspan="6" class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading pending products...</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="products-section hidden" id="verifiedProductsSection">
            <div class="section-header">
                <h2 class="section-title">Verified Products</h2>
                <div class="action-buttons">
                    <button class="btn btn-secondary btn-sm" onclick="hideVerifiedProducts()">
                        Show Pending Products
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="verifiedProductsTable">
                    <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Seller</th>
                        <th>Price</th>
                        <th>Carbon Footprint</th>
                        <th>Verified Date</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="verifiedProductsBody">
                    <tr>
                        <td colspan="6" class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading verified products...</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<!-- Shopper Page -->
<section id="shopperPage" class="hidden">
    <div class="shopper-header">
        <div class="container">
            <h1>Discover Sustainable Products</h1>
            <p>Browse our collection of verified eco-friendly products with transparent carbon footprints.</p>
        </div>
    </div>

    <div class="container">
        <div class="search-filter-section">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Search products by name..." onkeyup="filterProducts()">
                <button class="btn btn-primary" onclick="filterProducts()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>

            <div class="filter-options">
                <div class="filter-group">
                    <label for="categoryFilter">Category</label>
                    <select id="categoryFilter" class="filter-select" onchange="filterProducts()">
                        <option value="">All Categories</option>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="priceFilter">Price Range</label>
                    <select id="priceFilter" class="filter-select" onchange="filterProducts()">
                        <option value="">All Prices</option>
                        <option value="0-50">Under $50</option>
                        <option value="50-100">$50 - $100</option>
                        <option value="100-200">$100 - $200</option>
                        <option value="200-500">$200 - $500</option>
                        <option value="500+">$500+</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="ecoRatingFilter">Eco Rating</label>
                    <select id="ecoRatingFilter" class="filter-select" onchange="filterProducts()">
                        <option value="">All Ratings</option>
                        <option value="A+">A+ (Best)</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="sortFilter">Sort By</label>
                    <select id="sortFilter" class="filter-select" onchange="filterProducts()">
                        <option value="newest">Newest First</option>
                        <option value="price_asc">Price: Low to High</option>
                        <option value="price_desc">Price: High to Low</option>
                        <option value="carbon_asc">Carbon: Low to High</option>
                        <option value="rating">Highest Rated</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="productsContainer">
            <div class="products-grid" id="productsGrid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading products...</p>
                </div>
            </div>

            <div class="text-center mt-30" id="loadMoreContainer">
                <button class="btn btn-secondary" onclick="loadMoreProducts()">
                    <i class="fas fa-plus"></i> Load More Products
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Add/Edit Product Modal -->
<div class="modal" id="productModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Add New Product</h3>
            <button class="modal-close" onclick="closeProductModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="productForm">
                <input type="hidden" id="editProductId" value="">

                <div class="form-group">
                    <label for="productName">Product Name *</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="productDescription">Description *</label>
                    <textarea id="productDescription" class="form-control" rows="3" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label for="productPrice">Price ($) *</label>
                        <input type="number" id="productPrice" class="form-control" min="0.01" step="0.01" required>
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label for="productQuantity">Quantity *</label>
                        <input type="number" id="productQuantity" class="form-control" min="1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="productCategory">Category *</label>
                    <select id="productCategory" class="form-control" required>
                        <option value="">Select a category</option>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label>Product Image *</label>
                    <div class="image-preview" id="imagePreview">
                        <span>No image selected</span>
                    </div>
                    <input type="file" id="productImage" class="form-control" accept="image/*" onchange="previewImage()" required>
                    <small class="dashboard-subtitle">Image will be converted to Base64 format</small>
                </div>

                <div class="form-group">
                    <label>Carbon Footprint Breakdown (kg CO2e)</label>
                    <p class="dashboard-subtitle">Leave all as 0 to auto-calculate based on category</p>

                    <div class="carbon-inputs">
                        <div class="carbon-input">
                            <label>Manufacturing</label>
                            <input type="number" id="carbonManufacturing" min="0" step="0.01" value="0">
                        </div>
                        <div class="carbon-input">
                            <label>Transportation</label>
                            <input type="number" id="carbonTransportation" min="0" step="0.01" value="0">
                        </div>
                        <div class="carbon-input">
                            <label>Packaging</label>
                            <input type="number" id="carbonPackaging" min="0" step="0.01" value="0">
                        </div>
                        <div class="carbon-input">
                            <label>Usage</label>
                            <input type="number" id="carbonUsage" min="0" step="0.01" value="0">
                        </div>
                        <div class="carbon-input">
                            <label>Disposal</label>
                            <input type="number" id="carbonDisposal" min="0" step="0.01" value="0">
                        </div>
                    </div>
                </div>

                <div class="form-group mt-20">
                    <button type="button" class="btn btn-primary btn-block" onclick="saveProduct()">
                        <i class="fas fa-save"></i> Save Product
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Base URL for API
    const BASE_URL = 'http://localhost:8080';

    // Global variables
    let currentUser = null;
    let categories = [];
    let allProducts = []; // Store all products for frontend filtering
    let filteredProducts = [];
    let currentPage = 0;
    const pageSize = 12;
    let isEditingProduct = false;
    let currentView = 'landing';

    // DOM Elements
    const landingPage = document.getElementById('landingPage');
    const loginPage = document.getElementById('loginPage');
    const registerPage = document.getElementById('registerPage');
    const sellerDashboard = document.getElementById('sellerDashboard');
    const adminDashboard = document.getElementById('adminDashboard');
    const shopperPage = document.getElementById('shopperPage');
    const appHeader = document.getElementById('appHeader');
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById('userName');
    const userRole = document.getElementById('userRole');
    const loginAlert = document.getElementById('loginAlert');
    const registerAlert = document.getElementById('registerAlert');
    const productModal = document.getElementById('productModal');
    const imagePreview = document.getElementById('imagePreview');
    const productImageInput = document.getElementById('productImage');
    const categorySelect = document.getElementById('productCategory');
    const categoryFilter = document.getElementById('categoryFilter');

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is already logged in
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            try {
                currentUser = JSON.parse(savedUser);
                showAppHeader();
                updateUIForUser();
                loadCategories();

                // Show appropriate dashboard based on role
                if (currentUser.role === 'SELLER') {
                    showSellerDashboard();
                } else if (currentUser.role === 'ADMIN') {
                    showAdminDashboard();
                } else if (currentUser.role === 'USER') {
                    showShopperPage();
                }
            } catch (e) {
                console.error('Error parsing saved user:', e);
                localStorage.removeItem('currentUser');
                showLandingPage();
            }
        } else {
            showLandingPage();
        }

        // Setup menu toggle for mobile
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('navLinks').classList.toggle('active');
        });
    });

    // Show landing page
    function showLandingPage() {
        currentView = 'landing';
        hideAllSections();
        landingPage.classList.remove('hidden');
        appHeader.classList.add('hidden');
    }

    // Show login page
    function showLoginPage() {
        currentView = 'login';
        hideAllSections();
        loginPage.classList.remove('hidden');
        appHeader.classList.remove('hidden');
        updateActiveNav(null);
    }

    // Show register page
    function showRegisterPage() {
        currentView = 'register';
        hideAllSections();
        registerPage.classList.remove('hidden');
        appHeader.classList.remove('hidden');
        updateActiveNav(null);
    }

    // Show seller dashboard
    function showSellerDashboard() {
        if (!currentUser || currentUser.role !== 'SELLER') {
            showLoginPage();
            return;
        }

        currentView = 'seller';
        hideAllSections();
        sellerDashboard.classList.remove('hidden');
        showAppHeader();
        updateActiveNav('sellerLink');

        // Load seller data
        loadSellerProducts();
        loadSellerStats();
    }

    // Show admin dashboard
    function showAdminDashboard() {
        if (!currentUser || currentUser.role !== 'ADMIN') {
            showLoginPage();
            return;
        }

        currentView = 'admin';
        hideAllSections();
        adminDashboard.classList.remove('hidden');
        showAppHeader();
        updateActiveNav('adminLink');

        // Load admin data
        loadPendingProducts();
        loadAdminStats();
    }

    // Show shopper page
    function showShopperPage() {
        currentView = 'shopper';
        hideAllSections();
        shopperPage.classList.remove('hidden');
        showAppHeader();
        updateActiveNav('shopperLink');

        // Load products for shoppers
        loadAllProducts();
    }

    // Hide all sections
    function hideAllSections() {
        landingPage.classList.add('hidden');
        loginPage.classList.add('hidden');
        registerPage.classList.add('hidden');
        sellerDashboard.classList.add('hidden');
        adminDashboard.classList.add('hidden');
        shopperPage.classList.add('hidden');
    }

    // Show app header
    function showAppHeader() {
        appHeader.classList.remove('hidden');
    }

    // Update active navigation link
    function updateActiveNav(activeId) {
        // Remove active class from all nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });

        // Add active class to clicked link
        if (activeId) {
            document.getElementById(activeId).classList.add('active');
        }
    }

    // Update UI based on user role
    function updateUIForUser() {
        if (currentUser) {
            userName.textContent = currentUser.fullName || currentUser.email;

            // Set role badge
            if (currentUser.role === 'SELLER') {
                userRole.textContent = 'Seller';
                userRole.className = 'user-role role-seller';

                // Show/hide appropriate navigation
                document.getElementById('sellerLink').classList.remove('hidden');
                document.getElementById('adminLink').classList.add('hidden');
                document.getElementById('shopperLink').classList.remove('hidden');

            } else if (currentUser.role === 'ADMIN') {
                userRole.textContent = 'Admin';
                userRole.className = 'user-role role-admin';

                // Show/hide appropriate navigation
                document.getElementById('sellerLink').classList.add('hidden');
                document.getElementById('adminLink').classList.remove('hidden');
                document.getElementById('shopperLink').classList.add('hidden');

            } else if (currentUser.role === 'USER') {
                userRole.textContent = 'Shopper';
                userRole.className = 'user-role role-user';

                // Show/hide appropriate navigation
                document.getElementById('sellerLink').classList.add('hidden');
                document.getElementById('adminLink').classList.add('hidden');
                document.getElementById('shopperLink').classList.remove('hidden');
            }

            userInfo.classList.remove('hidden');
        } else {
            userInfo.classList.add('hidden');
        }
    }

    // Login function - REAL API CALL
    async function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        // Basic validation
        if (!email || !password) {
            showAlert('Please enter both email and password', 'error', loginAlert);
            return;
        }

        showLoading(loginAlert, 'Logging in...');

        try {
            const response = await fetch(`${BASE_URL}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Login failed');
            }

            // Save user to localStorage
            currentUser = data;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            // Update UI
            showAppHeader();
            updateUIForUser();
            loadCategories();

            // Show appropriate dashboard
            if (currentUser.role === 'SELLER') {
                showSellerDashboard();
            } else if (currentUser.role === 'ADMIN') {
                showAdminDashboard();
            } else {
                showShopperPage();
            }

            showAlert('Login successful!', 'success', loginAlert);

        } catch (error) {
            showAlert(error.message || 'Login failed. Please try again.', 'error', loginAlert);
            console.error('Login error:', error);
        }
    }

    // Register function - REAL API CALL
    async function register() {
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const fullName = document.getElementById('regFullName').value;
        const role = document.getElementById('regRole').value;

        // Basic validation
        if (!email || !password || !fullName) {
            showAlert('Please fill in all required fields', 'error', registerAlert);
            return;
        }

        if (password.length < 6) {
            showAlert('Password must be at least 6 characters', 'error', registerAlert);
            return;
        }

        showLoading(registerAlert, 'Creating account...');

        try {
            const response = await fetch(`${BASE_URL}/api/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password, fullName, role })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Registration failed');
            }

            showAlert('Registration successful! Please login.', 'success', registerAlert);

            // Clear form and switch to login
            document.getElementById('regEmail').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regFullName').value = '';

            setTimeout(() => {
                showLoginPage();
            }, 1500);

        } catch (error) {
            showAlert(error.message || 'Registration failed. Please try again.', 'error', registerAlert);
            console.error('Registration error:', error);
        }
    }

    // Logout function
    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        showLandingPage();
        showAlert('You have been logged out.', 'success');
    }

    // Show alert message
    function showAlert(message, type, alertElement = null) {
        if (!alertElement) {
            // Create a temporary alert at the top
            alertElement = document.createElement('div');
            alertElement.className = `alert alert-${type}`;
            alertElement.textContent = message;
            alertElement.style.position = 'fixed';
            alertElement.style.top = '80px';
            alertElement.style.left = '50%';
            alertElement.style.transform = 'translateX(-50%)';
            alertElement.style.zIndex = '1000';
            alertElement.style.width = '90%';
            alertElement.style.maxWidth = '500px';
            document.body.appendChild(alertElement);

            // Auto hide after 5 seconds
            setTimeout(() => {
                alertElement.remove();
            }, 5000);
        } else {
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.classList.remove('hidden');

            // Auto hide after 5 seconds
            setTimeout(() => {
                alertElement.classList.add('hidden');
            }, 5000);
        }
    }

    // Show loading state
    function showLoading(element, message = 'Loading...') {
        element.innerHTML = `<div class="loading-spinner"></div><p>${message}</p>`;
        element.classList.remove('hidden');
        element.classList.remove('alert-success', 'alert-error', 'alert-warning');
    }

    // Load categories from API - REAL API CALL
    async function loadCategories() {
        try {
            const response = await fetch(`${BASE_URL}/api/categories`);

            if (!response.ok) {
                throw new Error('Failed to load categories');
            }

            categories = await response.json();

            // Populate category dropdowns
            populateCategoryDropdowns();

        } catch (error) {
            console.error('Error loading categories:', error);
            // Fallback to default categories if API fails
            categories = [
                { id: 1, name: 'Clothing & Apparel' },
                { id: 2, name: 'Home & Kitchen' },
                { id: 3, name: 'Beauty & Personal Care' },
                { id: 4, name: 'Electronics' },
                { id: 5, name: 'Food & Beverages' }
            ];
            populateCategoryDropdowns();
        }
    }

    // Populate category dropdowns
    function populateCategoryDropdowns() {
        // Clear existing options
        categorySelect.innerHTML = '<option value="">Select a category</option>';
        categoryFilter.innerHTML = '<option value="">All Categories</option>';

        // Add categories to both dropdowns
        categories.forEach(category => {
            const option1 = document.createElement('option');
            option1.value = category.name;
            option1.textContent = category.name;
            categorySelect.appendChild(option1);

            const option2 = document.createElement('option');
            option2.value = category.name;
            option2.textContent = category.name;
            categoryFilter.appendChild(option2);
        });
    }

    // Load seller's products - REAL API CALL
    async function loadSellerProducts() {
        if (!currentUser || currentUser.role !== 'SELLER') return;

        const tbody = document.getElementById('sellerProductsBody');
        tbody.innerHTML = '<tr><td colspan="7" class="loading"><div class="loading-spinner"></div><p>Loading products...</p></td></tr>';

        try {
            const response = await fetch(`${BASE_URL}/api/products/seller/${currentUser.id}`);

            if (!response.ok) {
                throw new Error('Failed to load products');
            }

            const products = await response.json();

            // Update stats
            updateSellerStatsFromProducts(products);

            // Populate table
            populateSellerProductsTable(products);

        } catch (error) {
            console.error('Error loading seller products:', error);
            tbody.innerHTML = `<tr><td colspan="7" class="text-center">Error loading products: ${error.message}</td></tr>`;
        }
    }

    // Update seller stats from products
    function updateSellerStatsFromProducts(products) {
        const totalProducts = products.length;
        const verifiedProducts = products.filter(p => p.verified).length;
        const pendingProducts = totalProducts - verifiedProducts;
        const totalSales = products.reduce((sum, p) => sum + (p.soldCount || 0), 0);

        document.getElementById('sellerStats').innerHTML = `
            <div class="card">
                <h3 class="card-title"><i class="fas fa-box"></i> Total Products</h3>
                <div class="card-value">${totalProducts}</div>
            </div>

            <div class="card">
                <h3 class="card-title"><i class="fas fa-check-circle"></i> Verified Products</h3>
                <div class="card-value secondary">${verifiedProducts}</div>
            </div>

            <div class="card">
                <h3 class="card-title"><i class="fas fa-clock"></i> Pending Verification</h3>
                <div class="card-value warning">${pendingProducts}</div>
            </div>

            <div class="card">
                <h3 class="card-title"><i class="fas fa-chart-line"></i> Total Sales</h3>
                <div class="card-value">${totalSales}</div>
            </div>
        `;
    }

    // Populate seller products table
    function populateSellerProductsTable(products) {
        const tbody = document.getElementById('sellerProductsBody');

        if (products.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center">
                        No products found. Add your first product!
                    </td>
                </tr>
            `;
            return;
        }

        let tableHTML = '';
        products.forEach(product => {
            // Determine status badge
            let statusBadge = '';
            if (product.verified) {
                statusBadge = '<span class="badge badge-success">Verified</span>';
            } else {
                statusBadge = '<span class="badge badge-warning">Pending</span>';
            }

            // Determine eco rating badge
            let ecoRatingBadge = '';
            if (product.ecoRating) {
                ecoRatingBadge = `<span class="eco-rating rating-${product.ecoRating.toLowerCase().replace('+', '')}">${product.ecoRating}</span>`;
            }

            tableHTML += `
                <tr>
                    <td><img src="${product.imageUrl || 'https://via.placeholder.com/60x60?text=No+Image'}" alt="${product.name}" class="product-image"></td>
                    <td>
                        <strong>${product.name}</strong><br>
                        <small>${product.category || 'No category'}</small>
                    </td>
                    <td>$${product.price ? product.price.toFixed(2) : '0.00'}</td>
                    <td>${product.quantity || 0}</td>
                    <td>
                        <div class="carbon-badge">
                            <i class="fas fa-leaf"></i>
                            ${product.carbonFootprint || 0} kg CO2e
                            ${ecoRatingBadge}
                        </div>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <!-- Note: Delete button is intentionally omitted per client request -->
                        </div>
                    </td>
                </tr>
            `;
        });

        tbody.innerHTML = tableHTML;
    }

    // Load seller dashboard stats - REAL API CALL
    async function loadSellerStats() {
        if (!currentUser || currentUser.role !== 'SELLER') return;

        try {
            const response = await fetch(`${BASE_URL}/api/dashboard/seller/${currentUser.id}`);

            if (response.ok) {
                const dashboardData = await response.json();
                // Update dashboard with detailed stats
                document.getElementById('sellerStats').innerHTML = `
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-box"></i> Total Products</h3>
                        <div class="card-value">${dashboardData.stats?.totalProducts || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-check-circle"></i> Verified Products</h3>
                        <div class="card-value secondary">${dashboardData.stats?.verifiedProducts || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-clock"></i> Pending Verification</h3>
                        <div class="card-value warning">${dashboardData.stats?.pendingProducts || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Total Revenue</h3>
                        <div class="card-value">$${dashboardData.stats?.totalRevenue?.toFixed(2) || '0.00'}</div>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading seller stats:', error);
            // Stats will be updated from products if this fails
        }
    }

    // Load pending products for admin - REAL API CALL
    async function loadPendingProducts() {
        if (!currentUser || currentUser.role !== 'ADMIN') return;

        const tbody = document.getElementById('pendingProductsBody');
        tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="loading-spinner"></div><p>Loading pending products...</p></td></tr>';

        try {
            const response = await fetch(`${BASE_URL}/api/products/admin/pending`, {
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to load pending products');
            }

            const pendingProducts = await response.json();

            // Update stats
            document.getElementById('adminPendingProducts').textContent = pendingProducts.length;

            // Populate table
            populatePendingProductsTable(pendingProducts);

        } catch (error) {
            console.error('Error loading pending products:', error);
            tbody.innerHTML = `<tr><td colspan="6" class="text-center">Error loading pending products: ${error.message}</td></tr>`;
        }
    }

    // Populate pending products table
    function populatePendingProductsTable(products) {
        const tbody = document.getElementById('pendingProductsBody');

        if (products.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center">
                        No pending products for verification.
                    </td>
                </tr>
            `;
            return;
        }

        let tableHTML = '';
        products.forEach(product => {
            tableHTML += `
                <tr>
                    <td>
                        <strong>${product.name}</strong><br>
                        <small>${product.category || 'No category'}</small>
                    </td>
                    <td>${product.sellerName || 'Unknown Seller'}</td>
                    <td>$${product.price ? product.price.toFixed(2) : '0.00'}</td>
                    <td>
                        <div class="carbon-badge">
                            <i class="fas fa-leaf"></i>
                            ${product.carbonFootprint || 0} kg CO2e
                        </div>
                    </td>
                    <td>${formatDate(product.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="verifyProduct(${product.id})">
                                <i class="fas fa-check"></i> Verify
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });

        tbody.innerHTML = tableHTML;
    }

    // Load verified products for admin - REAL API CALL
    async function loadVerifiedProducts() {
        if (!currentUser || currentUser.role !== 'ADMIN') return;

        const tbody = document.getElementById('verifiedProductsBody');
        tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="loading-spinner"></div><p>Loading verified products...</p></td></tr>';

        try {
            // Since there's no direct API for verified products, we'll filter all products
            const response = await fetch(`${BASE_URL}/api/products`);

            if (!response.ok) {
                throw new Error('Failed to load products');
            }

            const data = await response.json();
            const verifiedProducts = data.products ? data.products.filter(p => p.verified) : [];

            // Populate table
            populateVerifiedProductsTable(verifiedProducts);

        } catch (error) {
            console.error('Error loading verified products:', error);
            tbody.innerHTML = `<tr><td colspan="6" class="text-center">Error loading verified products: ${error.message}</td></tr>`;
        }
    }

    // Populate verified products table
    function populateVerifiedProductsTable(products) {
        const tbody = document.getElementById('verifiedProductsBody');

        if (products.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center">
                        No verified products found.
                    </td>
                </tr>
            `;
            return;
        }

        let tableHTML = '';
        products.forEach(product => {
            tableHTML += `
                <tr>
                    <td>
                        <strong>${product.name}</strong><br>
                        <small>${product.category || 'No category'}</small>
                    </td>
                    <td>${product.sellerName || 'Unknown Seller'}</td>
                    <td>$${product.price ? product.price.toFixed(2) : '0.00'}</td>
                    <td>
                        <div class="carbon-badge">
                            <i class="fas fa-leaf"></i>
                            ${product.carbonFootprint || 0} kg CO2e
                        </div>
                    </td>
                    <td>${formatDate(product.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });

        tbody.innerHTML = tableHTML;
    }

    // Show verified products section
    function showVerifiedProducts() {
        document.getElementById('pendingProductsTable').parentElement.classList.add('hidden');
        document.getElementById('verifiedProductsSection').classList.remove('hidden');
        loadVerifiedProducts();
    }

    // Hide verified products section
    function hideVerifiedProducts() {
        document.getElementById('pendingProductsTable').parentElement.classList.remove('hidden');
        document.getElementById('verifiedProductsSection').classList.add('hidden');
    }

    // Load admin dashboard stats - REAL API CALL
    async function loadAdminStats() {
        if (!currentUser || currentUser.role !== 'ADMIN') return;

        try {
            const response = await fetch(`${BASE_URL}/api/dashboard/admin`);

            if (response.ok) {
                const dashboardData = await response.json();

                document.getElementById('adminStats').innerHTML = `
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-box"></i> Total Products</h3>
                        <div class="card-value">${dashboardData.platformStats?.totalProducts || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-clock"></i> Pending Verification</h3>
                        <div class="card-value warning">${dashboardData.platformStats?.pendingProducts || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-users"></i> Total Users</h3>
                        <div class="card-value secondary">${dashboardData.platformStats?.totalUsers || 0}</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Platform Revenue</h3>
                        <div class="card-value">$${dashboardData.platformStats?.totalRevenue?.toFixed(2) || '0.00'}</div>
                    </div>
                `;
            } else {
                // If dashboard API fails, show basic stats
                document.getElementById('adminStats').innerHTML = `
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-box"></i> Total Products</h3>
                        <div class="card-value">0</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-clock"></i> Pending Verification</h3>
                        <div class="card-value warning">0</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-users"></i> Total Users</h3>
                        <div class="card-value secondary">0</div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Platform Revenue</h3>
                        <div class="card-value">$0.00</div>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading admin stats:', error);
        }
    }

    // Load all products for shoppers - REAL API CALL
    async function loadAllProducts() {
        const productsGrid = document.getElementById('productsGrid');
        productsGrid.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>Loading products...</p></div>';

        try {
            // Load all products for frontend filtering
            const response = await fetch(`${BASE_URL}/api/products?size=100`);

            if (!response.ok) {
                throw new Error('Failed to load products');
            }

            const data = await response.json();
            allProducts = data.products || [];

            // Apply initial filter
            filterProducts();

        } catch (error) {
            console.error('Error loading products:', error);
            productsGrid.innerHTML = `<div class="text-center">Error loading products: ${error.message}</div>`;
        }
    }

    // Filter products (Frontend filtering since backend doesn't have filter API)
    function filterProducts() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const category = document.getElementById('categoryFilter').value;
        const priceRange = document.getElementById('priceFilter').value;
        const ecoRating = document.getElementById('ecoRatingFilter').value;
        const sortBy = document.getElementById('sortFilter').value;

        // Start with all products
        filteredProducts = [...allProducts];

        // Apply search filter
        if (searchTerm) {
            filteredProducts = filteredProducts.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                (product.description && product.description.toLowerCase().includes(searchTerm)) ||
                (product.category && product.category.toLowerCase().includes(searchTerm))
            );
        }

        // Apply category filter
        if (category) {
            filteredProducts = filteredProducts.filter(product =>
                product.category === category
            );
        }

        // Apply price filter
        if (priceRange) {
            filteredProducts = filteredProducts.filter(product => {
                const price = product.price || 0;
                switch(priceRange) {
                    case '0-50': return price <= 50;
                    case '50-100': return price > 50 && price <= 100;
                    case '100-200': return price > 100 && price <= 200;
                    case '200-500': return price > 200 && price <= 500;
                    case '500+': return price > 500;
                    default: return true;
                }
            });
        }

        // Apply eco rating filter
        if (ecoRating) {
            filteredProducts = filteredProducts.filter(product =>
                product.ecoRating === ecoRating
            );
        }

        // Apply sorting
        filteredProducts.sort((a, b) => {
            switch(sortBy) {
                case 'price_asc':
                    return (a.price || 0) - (b.price || 0);
                case 'price_desc':
                    return (b.price || 0) - (a.price || 0);
                case 'carbon_asc':
                    return (a.carbonFootprint || 0) - (b.carbonFootprint || 0);
                case 'rating':
                    return (b.averageRating || 0) - (a.averageRating || 0);
                case 'newest':
                default:
                    return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
            }
        });

        // Display filtered products
        displayFilteredProducts();
    }

    // Display filtered products
    function displayFilteredProducts() {
        const productsGrid = document.getElementById('productsGrid');

        if (filteredProducts.length === 0) {
            productsGrid.innerHTML = '<div class="text-center" style="grid-column: 1 / -1; padding: 40px;">No products found matching your criteria.</div>';
            document.getElementById('loadMoreContainer').classList.add('hidden');
            return;
        }

        // Show only first page
        const productsToShow = filteredProducts.slice(0, pageSize * (currentPage + 1));

        let productsHTML = '';
        productsToShow.forEach(product => {
            // Determine eco rating class
            let ratingClass = 'rating-b';
            if (product.ecoRating === 'A+') ratingClass = 'rating-a';
            else if (product.ecoRating === 'C') ratingClass = 'rating-c';

            productsHTML += `
                <div class="product-card">
                    <img src="${product.imageUrl || 'https://via.placeholder.com/300x200?text=Product'}" alt="${product.name}" class="product-img">
                    <div class="product-body">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="dashboard-subtitle">${product.description ? product.description.substring(0, 80) + '...' : 'No description available'}</p>
                        <div class="product-price">$${product.price ? product.price.toFixed(2) : '0.00'}</div>
                    </div>
                    <div class="product-footer">
                        <div class="carbon-badge">
                            <i class="fas fa-leaf"></i>
                            ${product.carbonFootprint || 0} kg CO2e
                        </div>
                        ${product.ecoRating ? `<span class="eco-rating ${ratingClass}">${product.ecoRating}</span>` : ''}
                    </div>
                </div>
            `;
        });

        productsGrid.innerHTML = productsHTML;

        // Show/hide load more button
        if (filteredProducts.length > productsToShow.length) {
            document.getElementById('loadMoreContainer').classList.remove('hidden');
        } else {
            document.getElementById('loadMoreContainer').classList.add('hidden');
        }
    }

    // Load more products (for pagination)
    function loadMoreProducts() {
        currentPage++;
        displayFilteredProducts();
    }

    // Show add product modal
    function showAddProductModal() {
        isEditingProduct = false;
        document.getElementById('modalTitle').textContent = 'Add New Product';
        document.getElementById('editProductId').value = '';
        document.getElementById('productForm').reset();
        imagePreview.innerHTML = '<span>No image selected</span>';
        productModal.classList.add('active');
    }

    // Show edit product modal
    async function editProduct(productId) {
        isEditingProduct = true;
        document.getElementById('modalTitle').textContent = 'Edit Product';
        document.getElementById('editProductId').value = productId;

        try {
            // Fetch product details
            const response = await fetch(`${BASE_URL}/api/products/${productId}`);

            if (!response.ok) {
                throw new Error('Failed to load product details');
            }

            const product = await response.json();

            // Populate form
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productQuantity').value = product.quantity || '';
            document.getElementById('productCategory').value = product.category || '';

            // Set carbon values from breakdown if available
            if (product.carbonBreakdown) {
                document.getElementById('carbonManufacturing').value = product.carbonBreakdown.manufacturing || 0;
                document.getElementById('carbonTransportation').value = product.carbonBreakdown.transportation || 0;
                document.getElementById('carbonPackaging').value = product.carbonBreakdown.packaging || 0;
                document.getElementById('carbonUsage').value = product.carbonBreakdown.usage || 0;
                document.getElementById('carbonDisposal').value = product.carbonBreakdown.disposal || 0;
            } else {
                // Reset to 0
                document.getElementById('carbonManufacturing').value = 0;
                document.getElementById('carbonTransportation').value = 0;
                document.getElementById('carbonPackaging').value = 0;
                document.getElementById('carbonUsage').value = 0;
                document.getElementById('carbonDisposal').value = 0;
            }

            // Set image preview
            if (product.imageUrl) {
                imagePreview.innerHTML = `<img src="${product.imageUrl}" alt="Product">`;
            } else {
                imagePreview.innerHTML = '<span>No image selected</span>';
            }

            productModal.classList.add('active');

        } catch (error) {
            console.error('Error loading product details:', error);
            showAlert('Failed to load product details', 'error');
        }
    }

    // Close product modal
    function closeProductModal() {
        productModal.classList.remove('active');
        isEditingProduct = false;
    }

    // Preview image before upload
    function previewImage() {
        const file = productImageInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
            };
            reader.readAsDataURL(file);
        } else {
            imagePreview.innerHTML = '<span>No image selected</span>';
        }
    }

    // Save product (add or update) - REAL API CALL
    async function saveProduct() {
        if (!currentUser) return;

        // Get form values
        const productId = document.getElementById('editProductId').value;
        const name = document.getElementById('productName').value;
        const description = document.getElementById('productDescription').value;
        const price = parseFloat(document.getElementById('productPrice').value);
        const quantity = parseInt(document.getElementById('productQuantity').value);
        const category = document.getElementById('productCategory').value;

        // Get carbon values
        const manufacturing = parseFloat(document.getElementById('carbonManufacturing').value) || 0;
        const transportation = parseFloat(document.getElementById('carbonTransportation').value) || 0;
        const packaging = parseFloat(document.getElementById('carbonPackaging').value) || 0;
        const usage = parseFloat(document.getElementById('carbonUsage').value) || 0;
        const disposal = parseFloat(document.getElementById('carbonDisposal').value) || 0;

        // Validation
        if (!name || !description || !price || !quantity || !category) {
            showAlert('Please fill in all required fields', 'error');
            return;
        }

        try {
            // Prepare product data
            const productData = {
                userId: currentUser.id,
                name,
                description,
                price,
                quantity,
                category,
                manufacturing,
                transportation,
                packaging,
                usage,
                disposal
            };

            // Add image if selected
            const file = productImageInput.files[0];
            if (file) {
                const base64 = await convertImageToBase64(file);
                productData.imageBase64 = base64;
            } else if (isEditingProduct) {
                // Keep existing image if editing and no new image selected
                productData.imageBase64 = '';
            } else {
                throw new Error('Product image is required');
            }

            let endpoint, method;
            if (isEditingProduct) {
                // Update existing product
                endpoint = `${BASE_URL}/api/products/${productId}`;
                method = 'PUT';
            } else {
                // Add new product
                endpoint = `${BASE_URL}/api/products/add`;
                method = 'POST';
            }

            const response = await fetch(endpoint, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(productData)
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || `Failed to ${isEditingProduct ? 'update' : 'add'} product`);
            }

            // Success
            showAlert(`Product ${isEditingProduct ? 'updated' : 'added'} successfully!`, 'success');
            closeProductModal();

            // Refresh seller products if in seller dashboard
            if (currentUser.role === 'SELLER') {
                loadSellerProducts();
                loadSellerStats();
            } else if (currentUser.role === 'ADMIN') {
                loadPendingProducts();
            }

        } catch (error) {
            showAlert(error.message || `Failed to ${isEditingProduct ? 'update' : 'add'} product. Please try again.`, 'error');
            console.error('Save product error:', error);
        }
    }

    // Verify product (admin only) - REAL API CALL
    async function verifyProduct(productId) {
        if (!currentUser || currentUser.role !== 'ADMIN') return;

        const confirmVerify = confirm('Are you sure you want to verify this product?');
        if (!confirmVerify) return;

        try {
            const response = await fetch(
                `${BASE_URL}/api/products/admin/verify/${productId}?adminId=${currentUser.id}`,
                { method: 'PUT' }
            );

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to verify product');
            }

            showAlert('Product verified successfully!', 'success');
            loadPendingProducts();
            loadAdminStats();

        } catch (error) {
            showAlert(error.message || 'Failed to verify product', 'error');
            console.error('Verify product error:', error);
        }
    }

    // Delete product (admin only) - REAL API CALL
    async function deleteProduct(productId) {
        if (!currentUser || currentUser.role !== 'ADMIN') return;

        const confirmDelete = confirm('Are you sure you want to delete this product?');
        if (!confirmDelete) return;

        try {
            const response = await fetch(
                `${BASE_URL}/api/products/${productId}?userId=${currentUser.id}`,
                { method: 'DELETE' }
            );

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to delete product');
            }

            showAlert('Product deleted successfully!', 'success');

            // Refresh data based on current view
            if (currentUser.role === 'ADMIN') {
                if (document.getElementById('verifiedProductsSection').classList.contains('hidden')) {
                    loadPendingProducts();
                } else {
                    loadVerifiedProducts();
                }
                loadAdminStats();
            }

        } catch (error) {
            showAlert(error.message || 'Failed to delete product', 'error');
            console.error('Delete product error:', error);
        }
    }

    // Helper function to convert image to base64
    function convertImageToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // Helper function to format date
    function formatDate(dateString) {
        if (!dateString) return 'N/A';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (e) {
            return 'Invalid Date';
        }
    }

    // Helper function to format currency
    function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        }).format(amount);
    }
</script>
</body>
</html>